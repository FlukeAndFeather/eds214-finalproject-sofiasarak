---
title: "EDS 214 Final Project"
author: "Sofia Sarak"
format: html
editor: visual
---

```{r}
#| include: false
library(tidyverse)
library(here)
library(janitor)
library(lubridate)
```

## Background

## Data

Data from the four sites summarized by the figure exist in different data frames. Here, we import and then combine all of them into one data frame called "bisley_streams".
```{r}
#| messages: false

rm(list=ls())

# using dplyr::read_csv() and here::here() to read in files from our data folder
# janitor::clean_names() is used to put all vairables name into lower snake case
prm <- read_csv(here("data", "RioMameyesPuenteRoto.csv")) %>% 
  clean_names()
bq1 <- read_csv(here("data", "QuebradaCuenca1-Bisley.csv")) %>% 
  clean_names()
bq2 <- read_csv(here("data", "QuebradaCuenca2-Bisley.csv")) %>% 
  clean_names()
bq3 <- read_csv(here("data", "QuebradaCuenca3-Bisley.csv")) %>% 
  clean_names()

# combining all four data sets, one at a time, using full_join() because we want to keep all observations from all sites!
bisley_streams <- full_join(prm, bq1)
bisley_streams <- full_join(bisley_streams, bq2)
bisley_streams <- full_join(bisley_streams, bq3)

# removing the four individual data sets from our global environment as we won't need them anymore
rm(bq1, bq2, bq3, prm)
```

Further cleaning of our data includes removing unnecessary columns and adding a year column.
```{r}
# using dplyr::select() to keep only the variables necessary for our analysis
bisley_streams <- bisley_streams %>% 
  select(sample_id, code, sample_date, k, no3_n, mg, ca, nh4_n)

# using lubirate::year() to create a year column, and then only keeping necessary years
bisley_streams <- bisley_streams %>% 
  mutate(year = year(as_date(sample_date))) %>% 
  relocate(year, .after= sample_date) %>% 
  filter(year>1988, year<1996)
```


## Methods

Figure 3 calls for the use of moving averages. We source the function moving_average() from an .R file in our R folder, all of which we made beforehand.

```{r}
# loading the function into our global environment
source(here("R", "moving_average.R"))

#using sapply()

bisley_streams$ca_9wk_avg <- sapply(
  bisley_streams$sample_date,
  moving_average,
  dates = bisley_streams$sample_date,
  value = bisley_streams$ca,
  interval_wks = 9
)

bisley_streams$no3_n_9wk_avg <- sapply(
  bisley_streams$sample_date,
  moving_average,
  dates = bisley_streams$sample_date,
  value = bisley_streams$no3_n,
  interval_wks = 9
)

conc_vec <- c("k", "no3_n", "mg", "ca", "nh4_n")



```

## Results

```{r}
ca_plot <- ggplot(data = bisley_streams, aes(x = sample_date, y = ca_9wk_avg)) + 
  geom_line() 
  geom_line(aes(x = as.integer(1989)))
ca_plot
```

